import{d as R,h as b,i as v,c as _,m as y,v as z,a as S,k as x,w as B,b as U,e as C,g as D}from"./index-jW0kkPld.js";import{a as N}from"./axios-B4uVmeYG.js";async function F(h,u){const t=h.length,e=Object(h);let n=0;for(;n<t;){if(n in e){const f=e[n];await u(f,n,e)}n++}}const O={class:"download"},V=R({__name:"download",setup(h){const u=Math.floor(419430.4),t=b("f1708607957313.png"),e=v({fileName:"",fileRemoteUrl:"",totalFileSize:0,chunkSize:u,chunkRanges:[],chunkRangeData:[]}),n=()=>{if(!t.value)return;Object.assign(e,{fileName:t.value,fileRemoteUrl:"",totalFileSize:0,chunkSize:u,chunkRanges:[],chunkRangeData:[]});const a=`http://localhost:3000/file/download?fileName=${t.value}`;f(a)};async function f(a){const l=(await N.head(a)).headers["content-length"]||"0",i=parseInt(l);e.totalFileSize=i;let r=-1;for(;r<i;){const o=r+1,s=r+e.chunkSize;e.chunkRanges.push({start:o,end:s,status:0}),r=s}await F(e.chunkRanges,async(o,s)=>{const g=await k(a,o.start,o.end);e.chunkRangeData[s]=g});const w=e.chunkRangeData.reduce((o,s)=>[...o,s],[]),m=new Blob(w),p=URL.createObjectURL(m),d=document.createElement("a");d.href=p,d.download="downloaded_file.png",document.body.appendChild(d),d.click(),URL.revokeObjectURL(p)}async function k(a,c,l){return await(await fetch(a,{headers:{Range:`bytes=${c}-${l}`}})).arrayBuffer()}return(a,c)=>{const l=U("el-button");return C(),_("div",O,[y(S("input",{type:"text","onUpdate:modelValue":c[0]||(c[0]=i=>t.value=i)},null,512),[[z,t.value]]),x(l,{onClick:n},{default:B(()=>[D("开始分片下载")]),_:1})])}}});export{V as default};
