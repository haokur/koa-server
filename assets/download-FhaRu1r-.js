import{d as w,i as b,v,c as g,m as R,x as _,a as y,p as U,w as x,b as z,e as C,g as S}from"./index-BUwSWzSU.js";import{A as B,a as D}from"./axios-b2ErKn4C.js";var N={title:"生产环境",baseUrl:"https://api.haokur.com"};const F={class:"download"},L=2,V=w({__name:"download",setup(j){const u=Math.floor(419430.4),l=b("f1708607957313.png"),a=v({fileName:"",fileUrl:"",fileRemoteUrl:"",totalFileSize:0,chunkSize:u,chunkRanges:[],chunkRangeData:[]}),f=()=>{if(!l.value)return;l.value!==a.fileName&&Object.assign(a,{fileName:l.value,fileRemoteUrl:"",totalFileSize:0,chunkSize:u,chunkRanges:[],chunkRangeData:[]});const e=`${N.baseUrl}/file/download?fileName=${l.value}`;k(e)};async function h(){const e=a.chunkRangeData.reduce((s,c)=>[...s,c],[]),o=new Blob(e),t=URL.createObjectURL(o),n=document.createElement("a");n.href=t,n.download="downloaded_file.png",document.body.appendChild(n),n.click(),URL.revokeObjectURL(t)}const i=new B(L,!0);i.finishCallback=h;async function p(e){const t=(await D.head(e)).headers["content-length"]||"0",n=parseInt(t);a.totalFileSize=n;let s=-1,c=0;for(;s<n;){const r=s+1,d=s+a.chunkSize;a.chunkRanges.push({start:r,end:d,status:0,index:c}),s=d,c++}}async function k(e){e!==a.fileUrl&&(i.clear(),a.fileUrl=e,await p(e));const o=async t=>{let{index:n,start:s,end:c}=t;const r=await m(e,s,c);a.chunkRangeData[n]=r};i.addManyTask(a.chunkRanges,o),i.run()}async function m(e,o,t){return await(await fetch(e,{headers:{Range:`bytes=${o}-${t}`}})).arrayBuffer()}return(e,o)=>{const t=z("el-button");return C(),g("div",F,[R(y("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=n=>l.value=n)},null,512),[[_,l.value]]),U(t,{onClick:f},{default:x(()=>[S("开始分片下载")]),_:1})])}}});export{V as default};
