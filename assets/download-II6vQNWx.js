import{d as v,h as _,i as b,c as x,m as z,v as S,a as y,k as C,w as B,b as U,e as D,g as N}from"./index-DXaxPZY2.js";import{a as F,C as L}from"./ConcurrentQueen-BWhXleLe.js";const j={class:"download"},Q=v({__name:"download",setup(O){const u=Math.floor(419430.4),a=_("f1708607957313.png"),e=b({fileName:"",fileRemoteUrl:"",totalFileSize:0,chunkSize:u,chunkRanges:[],chunkRangeData:[]}),f=()=>{if(!a.value)return;Object.assign(e,{fileName:a.value,fileRemoteUrl:"",totalFileSize:0,chunkSize:u,chunkRanges:[],chunkRangeData:[]});const n=`http://localhost:3000/file/download?fileName=${a.value}`;h(n)};async function h(n){const s=(await F.head(n)).headers["content-length"]||"0",c=parseInt(s);e.totalFileSize=c;let l=-1;for(;l<c;){const r=l+1,t=l+e.chunkSize;e.chunkRanges.push({start:r,end:t,status:0}),l=t}const m=2;await new L(e.chunkRanges,m,async r=>{let{task:t,index:g}=r;const R=await p(n,t.start,t.end);e.chunkRangeData[g]=R}).start();const k=e.chunkRangeData.reduce((r,t)=>[...r,t],[]),w=new Blob(k),d=URL.createObjectURL(w),i=document.createElement("a");i.href=d,i.download="downloaded_file.png",document.body.appendChild(i),i.click(),URL.revokeObjectURL(d)}async function p(n,o,s){return await(await fetch(n,{headers:{Range:`bytes=${o}-${s}`}})).arrayBuffer()}return(n,o)=>{const s=U("el-button");return D(),x("div",j,[z(y("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=c=>a.value=c)},null,512),[[S,a.value]]),C(s,{onClick:f},{default:B(()=>[N("开始分片下载")]),_:1})])}}});export{Q as default};
