import{d as m,h as b,s as v,c as g,l as R,v as U,a as _,n as y,w as x,b as z,e as C,g as S}from"./index-L1yGkUwH.js";import{A as B,a as D}from"./axios-b2ErKn4C.js";var N={title:"生产环境",baseUrl:"https://api.haokur.com",workerBaseUrl:"workers"};const F={class:"download"},L=2,V=m({__name:"download",setup(j){const u=Math.floor(419430.4),l=b("f1708607957313.png"),a=v({fileName:"",fileUrl:"",fileRemoteUrl:"",totalFileSize:0,chunkSize:u,chunkRanges:[],chunkRangeData:[]}),f=()=>{if(!l.value)return;l.value!==a.fileName&&Object.assign(a,{fileName:l.value,fileRemoteUrl:"",totalFileSize:0,chunkSize:u,chunkRanges:[],chunkRangeData:[]});const e=`${N.baseUrl}/file/download?fileName=${l.value}`;p(e)};async function h(){const e=a.chunkRangeData.reduce((s,c)=>[...s,c],[]),o=new Blob(e),t=URL.createObjectURL(o),n=document.createElement("a");n.href=t,n.download="downloaded_file.png",document.body.appendChild(n),n.click(),URL.revokeObjectURL(t)}const r=new B(L,!0);r.finishCallback=h;async function k(e){const t=(await D.head(e)).headers["content-length"]||"0",n=parseInt(t);a.totalFileSize=n;let s=-1,c=0;for(;s<n;){const i=s+1,d=s+a.chunkSize;a.chunkRanges.push({start:i,end:d,status:0,index:c}),s=d,c++}}async function p(e){e!==a.fileUrl&&(r.clear(),a.fileUrl=e,await k(e));const o=async t=>{let{index:n,start:s,end:c}=t;const i=await w(e,s,c);a.chunkRangeData[n]=i};r.addManyTask(a.chunkRanges,o),r.run()}async function w(e,o,t){return await(await fetch(e,{headers:{Range:`bytes=${o}-${t}`}})).arrayBuffer()}return(e,o)=>{const t=z("el-button");return C(),g("div",F,[R(_("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=n=>l.value=n)},null,512),[[U,l.value]]),y(t,{onClick:f},{default:x(()=>[S("开始分片下载")]),_:1})])}}});export{V as default};
